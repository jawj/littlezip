var P,Y=()=>{let f=Int32Array,l=new f(256),c=new f(4096),r,n,s;for(n=0;n<256;n++)r=n,r=r&1?-306674912^r>>>1:r>>>1,r=r&1?-306674912^r>>>1:r>>>1,r=r&1?-306674912^r>>>1:r>>>1,r=r&1?-306674912^r>>>1:r>>>1,r=r&1?-306674912^r>>>1:r>>>1,r=r&1?-306674912^r>>>1:r>>>1,r=r&1?-306674912^r>>>1:r>>>1,c[n]=l[n]=r&1?-306674912^r>>>1:r>>>1;for(n=0;n<256;n++)for(s=l[n],r=256+n;r<4096;r+=256)s=c[r]=s>>>8^l[s&255];for(P=[l],n=1;n<16;n++)P[n]=c.subarray(n*256,(n+1)*256)},N=(f,l=0)=>{P||Y();let[c,r,n,s,S,k,C,U,g,E,I,t,e,h,i,d]=P,o=l^-1,m=f.length-15,a=0;for(;a<m;)o=d[f[a++]^o&255]^i[f[a++]^o>>8&255]^h[f[a++]^o>>16&255]^e[f[a++]^o>>>24]^t[f[a++]]^I[f[a++]]^E[f[a++]]^g[f[a++]]^U[f[a++]]^C[f[a++]]^k[f[a++]]^S[f[a++]]^s[f[a++]]^n[f[a++]]^r[f[a++]]^c[f[a++]];for(m+=15;a<m;)o=o>>>8^c[(o^f[a++])&255];return~o};var j=typeof CompressionStream<"u",R=new TextEncoder,W=f=>f.reduce((l,c)=>l+c.length,0),Z=Uint8Array;function q(f){let l=new CompressionStream("gzip"),c=l.writable.getWriter(),r=l.readable.getReader();return c.write(f),c.close(),()=>r.read()}async function Q(f,l=!0,c=q){let r=[],n=j&&l,s=f.length,S=f.map(i=>R.encode(i.path)),k=f.map(({data:i})=>typeof i=="string"?R.encode(i):i instanceof ArrayBuffer?new Z(i):i),C=W(k),U=W(S),g=s*46+U,E=C+s*30+U+g+22,I=new Date,t=new Z(E),e=0;for(let i=0;i<s;i++){r[i]=e;let d=S[i],o=d.length,m=k[i],a=m.length,p=f[i].lastModified??I,F=(p.getSeconds()/2|0)+(p.getMinutes()<<5)+(p.getHours()<<11),H=p.getDate()+(p.getMonth()+1<<5)+(p.getFullYear()-1980<<9),T=0,z=!1;t[e++]=80,t[e++]=75,t[e++]=3,t[e++]=4,t[e++]=20,t[e++]=0,t[e++]=0,t[e++]=8;let G=e;t[e++]=t[e++]=0,t[e++]=F&255,t[e++]=F>>8,t[e++]=H&255,t[e++]=H>>8;let x=e;if(e+=8,t[e++]=a&255,t[e++]=a>>8&255,t[e++]=a>>16&255,t[e++]=a>>24,t[e++]=o&255,t[e++]=o>>8,t[e++]=t[e++]=0,t.set(d,e),e+=o,n){let y=e,M=c(m),b,A=0,v=0;e:{for(;;){let u=await M();if(u.done)throw new Error("Bad gzip data");if(b=u.value,A=v,v=A+b.length,A<=3&&v>3&&b[3-A]&30){z=!0;break e}if(v>=10){b=b.subarray(10-A);break}}for(;;){let u=e-y,w=b.length;if(u+w>=a+8){z=!0;break e}t.set(b,e),e+=w;let O=await M();if(O.done)break;b=O.value}}if(z)for(;;){let u=b.length,w=8-u,O=e;e=y;for(let D=0;D<8;D++)t[e++]=D<w?t[O-w+D]:b[u-8+D];let L=await M();if(L.done)break;b=L.value}e-=8,t[x++]=t[e++],t[x++]=t[e++],t[x++]=t[e++],t[x++]=t[e++],e-=4,z||(t[G]=8,T=e-y)}if((!n||z)&&(t.set(m,e),e+=a,T=a),!n){let y=N(m);t[x++]=y&255,t[x++]=y>>8&255,t[x++]=y>>16&255,t[x++]=y>>24}t[x++]=T&255,t[x++]=T>>8&255,t[x++]=T>>16&255,t[x++]=T>>24}let h=e;for(let i=0;i<s;i++){let d=r[i],o=S[i],m=o.length;t[e++]=80,t[e++]=75,t[e++]=1,t[e++]=2,t[e++]=20,t[e++]=0,t[e++]=20,t[e++]=0,t.set(t.subarray(d+6,d+30),e),e+=24,t[e++]=t[e++]=t[e++]=t[e++]=t[e++]=t[e++]=t[e++]=t[e++]=t[e++]=t[e++]=0,t[e++]=d&255,t[e++]=d>>8&255,t[e++]=d>>16&255,t[e++]=d>>24,t.set(o,e),e+=m}return t[e++]=80,t[e++]=75,t[e++]=5,t[e++]=6,t[e++]=t[e++]=t[e++]=t[e++]=0,t[e++]=s&255,t[e++]=s>>8,t[e++]=s&255,t[e++]=s>>8,t[e++]=g&255,t[e++]=g>>8&255,t[e++]=g>>16&255,t[e++]=g>>24,t[e++]=h&255,t[e++]=h>>8&255,t[e++]=h>>16&255,t[e++]=h>>24,t[e++]=t[e++]=0,t.subarray(0,e)}export{Q as createZip};
