var I,q=()=>{let f=Int32Array,c=new f(256),l=new f(4096),r,s,i;for(s=0;s<256;s++)r=s,r=r&1?-306674912^r>>>1:r>>>1,r=r&1?-306674912^r>>>1:r>>>1,r=r&1?-306674912^r>>>1:r>>>1,r=r&1?-306674912^r>>>1:r>>>1,r=r&1?-306674912^r>>>1:r>>>1,r=r&1?-306674912^r>>>1:r>>>1,r=r&1?-306674912^r>>>1:r>>>1,l[s]=c[s]=r&1?-306674912^r>>>1:r>>>1;for(s=0;s<256;s++)for(i=c[s],r=256+s;r<4096;r+=256)i=l[r]=i>>>8^c[i&255];for(I=[c],s=1;s<16;s++)I[s]=l.subarray(s*256,(s+1)*256)},W=(f,c=0)=>{I||q();let[l,r,s,i,w,A,M,D,y,U,E,t,e,p,n,x]=I,o=c^-1,m=f.length-15,a=0;for(;a<m;)o=x[f[a++]^o&255]^n[f[a++]^o>>8&255]^p[f[a++]^o>>16&255]^e[f[a++]^o>>>24]^t[f[a++]]^E[f[a++]]^U[f[a++]]^y[f[a++]]^D[f[a++]]^M[f[a++]]^A[f[a++]]^w[f[a++]]^i[f[a++]]^s[f[a++]]^r[f[a++]]^l[f[a++]];for(m+=15;a<m;)o=o>>>8^l[(o^f[a++])&255];return~o};var J=typeof CompressionStream<"u",Z=new TextEncoder,G=f=>f.reduce((c,l)=>c+l,0),P=Uint8Array,Y=10;function K(f){let c=new CompressionStream("gzip"),l=c.writable.getWriter(),r=c.readable.getReader();return l.write(f),l.close(),()=>r.read()}async function X(f,c=!0,l=K){let r=[],s=J&&c,i=f.length,w=f.map(n=>Z.encode(n.name)),A=f.map(({data:n})=>typeof n=="string"?Z.encode(n):n instanceof ArrayBuffer?new P(n):n),M=G(A.map(n=>n.byteLength)),D=G(w.map(n=>n.byteLength)),y=i*46+D,U=M+i*30+D+y+22,E=new Date,t=new P(U),e=0;for(let n=0;n<i;n++){r[n]=e;let x=w[n],o=x.byteLength,m=A[n],a=m.byteLength,T=f[n].lastModified??E,C=Math.floor(T.getSeconds()/2)+(T.getMinutes()<<5)+(T.getHours()<<11),F=T.getDate()+(T.getMonth()+1<<5)+(T.getFullYear()-1980<<9);t[e++]=80,t[e++]=75,t[e++]=3,t[e++]=4,t[e]=20,e+=3,t[e++]=8;let j=e;e+=2,t[e++]=C&255,t[e++]=C>>8,t[e++]=F&255,t[e++]=F>>8;let L=e;e+=4;let O=e;e+=4,t[e++]=a&255,t[e++]=a>>8&255,t[e++]=a>>16&255,t[e++]=a>>24,t[e++]=o&255,t[e]=o>>8&255,e+=3,t.set(x,e),e+=o;let u;if(s){let d=e,H=l(m),b,S=0,k=0,N=!1;e:{for(;;){let g=await H();if(g.done)throw new Error("Incomplete gzip data");if(b=g.value,S=k,k=S+b.length,S<=3&&k>3&&b[3-S]&30){N=!0;break e}if(k>=Y){b=b.subarray(Y-S);break}}for(;;){let g=e-d,h=b.byteLength;if(g+h>=a){N=!0;break e}t.set(b,e),e+=h;let v=await H();if(v.done)break;b=v.value}}if(N)for(;;){let g=b.byteLength,h=8-g,v=e;e=d;for(let z=0;z<8;z++)t[e++]=z<h?t[v-h+z]:b[g-8+z];let R=await H();if(R.done)break;b=R.value}e-=8,t[L++]=t[e++],t[L++]=t[e++],t[L++]=t[e++],t[L++]=t[e++],e-=4,N?(t.set(m,e),e+=a,u=a):(t[j]=8,u=e-d)}else{t.set(m,e),e+=a,u=a;let d=W(m);t[e++]=d&255,t[e++]=d>>8&255,t[e++]=d>>16&255,t[e++]=d>>24}t[O++]=u&255,t[O++]=u>>8&255,t[O++]=u>>16&255,t[O++]=u>>24}let p=e;for(let n=0;n<i;n++){let x=r[n],o=w[n],m=o.byteLength;t[e++]=80,t[e++]=75,t[e++]=1,t[e++]=2,t[e]=20,e+=2,t[e]=20,e+=2,t.set(t.subarray(x+6,x+30),e),e+=34,t[e++]=x&255,t[e++]=x>>8&255,t[e++]=x>>16&255,t[e++]=x>>24,t.set(o,e),e+=m}return t[e++]=80,t[e++]=75,t[e++]=5,t[e]=6,e+=5,t[e++]=i&255,t[e++]=i>>8&255,t[e++]=i&255,t[e++]=i>>8&255,t[e++]=y&255,t[e++]=y>>8&255,t[e++]=y>>16&255,t[e++]=y>>24,t[e++]=p&255,t[e++]=p>>8&255,t[e++]=p>>16&255,t[e]=p>>24,t.subarray(0,e+3)}export{X as createZip};
